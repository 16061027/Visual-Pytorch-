# 前端设计

## 一、函数及功能

### 1、save_network()函数

该函数主要实现将已经拖动构建好的网络保存，其中data，static和network是三个主要变量。

- data：保存network和static，是所需存储数据的总体。
- static：保存不可拖动方块中的数据，即模型的全局变量。
- network：保存通过拖动连线所构成的网络的数据，即各层的变量及整个模型的结构。

### 2、save_attr_linear_layer(button)函数

保存全连接层中的变量数据，在button被触发时，将层的全部数据存入localStorage，来实现数据的临时保存。

### 3、save_attr_view_layer(button)函数

保存reshape中的变量数据，在button被触发时，将层的全部数据存入localStorage，来实现数据的临时保存。

### 4、save_attr_conv1d_layer(button)函数

保存一维卷积层中的变量数据，在button被触发时，将层的全部数据存入localStorage，来实现数据的临时保存。

### 5、save_attr_conv2d_layer(button)函数

保存二维卷积层中的变量数据，在button被触发时，将层的全部数据存入localStorage，来实现数据的临时保存。

### 6、get_content(name,parid)函数

根据层的类型不同，从localStorage中获取到相应的变量数据，显示在所弹出窗口的相应位置，使用户实时查看到自己在相应层所填入的变量数据。

### 7、popover_show(id, name)函数

用于在每次打开单层参数输入窗口时对窗口内的参数进行填写，即将用户已输入的参数从localStorage中获取并填入相应位置，保证参数的正常显示。

### 8、popover_restart(name, id)函数

popover_show的子函数，清楚新生成窗口的默认参数，从loaclStorage中获取参数填入新生成窗口中。

## 二、ajax方法设计

### 1、网络模型生成部分

网络模型生成部分有两个ajax方法：

- 类型为POST，url为'NeuralNetwork/network/'，该方法所用的data与save_network()函数中的相同，该方法作用是将已创建好的网络模型以JSON形式传至后端接口。
- 类型为POST，url为'NeuralNetwork/getcode/'，所用data与以上方法相同，作用是传送数据至后端并对后端发出指令，令后端对传入的网络模型进行解析转换，得到相应代码。

### 2、访问量统计部分

访问量统计部分也存在两个ajax方法：

- 其一在index.html中，类型为POST，url为 'journal/'，data包含name和index两个部分，作用是将访问记录传至后端。
- 其二在statistics.html中，类型为GET，url为 'journal/'，作用为获取后台已记录的访问量数据。

# 后端接口设计

## 一、访问量统计接口Visit

### 1、提交访问数据

| 字段              | 内容          |
| ----------------- | ------------- |
| http请求类型      | POST          |
| url               | [ip]/journal/ |
| status（success） | 201           |
| status（failure） | 400           |

**data字段**

```
{
    “name”:[网页名称]
}
```

### 2、请求访问数据

| 字段              | 内容         |
| ----------------- | ------------ |
| http请求类型      | GET          |
| url               | [ip]/journal |
| status（success） | 200          |
| status（failure） | 400          |

**返回值示例**

```
{
    "visit_count": 119,
    "date_count_list": [
        {
            "id": 1,
            "day": "2019-04-18",
            "count": 70
        },
        {
            "id": 2,
            "day": "2019-04-19",
            "count": 49
        }
    ],
    "network_api_count": 57
}
```



## 二、网络模型接口

### 1、NetworkList类

#### （1）获得存储的模型

| 字段              | 内容                        |
| ----------------- | --------------------------- |
| http请求类型      | GET                         |
| url               | [ip]/NeuralNetwork/network/ |
| status（success） | 200                         |
| status（failure） | 400                         |

**返回值示例**

```
[
    {
        "id": 100,
        "creator": -1,
        "structure": "{'network': [{'source': {'id': 'canvas_1', 'name': 'start', 'attribute': {'start': 'true'}}, 'target': {'id': 'canvas_2', 'name': 'view_layer', 'attribute': {'shape': ''}}}], 'static': {'epoch': '', 'learning_rate': '', 'batch_size': ''}}",
        "time": "2019-04-18T07:35:43.036087Z"
    },
    {
        "id": 101,
        "creator": -1,
        "structure": "{'network': [{'source': {'id': 'canvas_1', 'name': 'start', 'attribute': {'start': 'true'}}, 'target': {'id': 'canvas_2', 'name': 'view_layer', 'attribute': {'shape': '4'}}}], 'static': {'epoch': '', 'learning_rate': '', 'batch_size': ''}}",
        "time": "2019-04-18T07:35:48.066113Z"
    }
]
```

#### (2) 保存模型

| 字段              | 内容                        |
| ----------------- | --------------------------- |
| http请求类型      | POST                        |
| url               | [ip]/NeuralNetwork/network/ |
| status（success） | 201                         |
| status（failure） | 400                         |

**data字段**

```
{
    "creator":[用户令牌,未登录默认为-1],
    "structure":[前端的模型]
}
```

### 2、NetworkDetail类

该类用于对后端已存储的网络模型进行一些细节操作。

#### （1）根据id获取模型

| 字段              | 内容                             |
| ----------------- | -------------------------------- |
| http请求类型      | GET                              |
| url               | [ip]/NeuralNetwork/network/[id]/ |
| status（success） | 200                              |
| status（failure） | 400                              |

**返回值示例**

```
{
        "id": 101,
        "creator": -1,
        "structure": "{'network': [{'source': {'id': 'canvas_1', 'name': 'start', 'attribute': {'start': 'true'}}, 'target': {'id': 'canvas_2', 'name': 'view_layer', 'attribute': {'shape': '4'}}}], 'static': {'epoch': '', 'learning_rate': '', 'batch_size': ''}}",
        "time": "2019-04-18T07:35:48.066113Z"
    }
```

#### （2）根据id修改模型

| 字段              | 内容                             |
| ----------------- | -------------------------------- |
| http请求类型      | PUT                              |
| url               | [ip]/NeuralNetwork/network/[id]/ |
| status（success） | 200                              |
| status（failure） | 400                              |

**data字段**

```
{
    "creator":[用户令牌,未登录默认为-1],
    "structure":[前端的模型]
}
```

#### （3）根据id删除模型

| 字段              | 内容                             |
| ----------------- | -------------------------------- |
| http请求类型      | DELETE                           |
| url               | [ip]/NeuralNetwork/network/[id]/ |
| status（success） | 200                              |
| status（failure） | 400                              |

### 3、代码生成接口

| 字段              | 内容                        |
| ----------------- | --------------------------- |
| http请求类型      | POST                        |
| url               | [ip]/NeuralNetwork/getcode/ |
| status（success） | 200                         |
| status（failure） | 400                         |

**data字段**

```
{
    "creator":[用户令牌,未登录默认为-1],
    "structure":[前端的模型]
}
```

**返回值**

```
{
    "Main":[Main模块代码],
    "Model":[Model模块代码],
    "Ops":[Ops模块代码]
}
```

